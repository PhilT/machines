user <%= AppConf.user.name %>;
worker_processes  4;

events {
  worker_connections  1024;
}


http {
  include       mime.types;
  default_type  application/octet-stream;

  sendfile            on;
  tcp_nopush          on;
  tcp_nodelay         off;
  keepalive_timeout   65;
  keepalive_requests  0;      # http://technosophos.com/content/nginx-tcpnopush-sendfile-and-memcache-right-configuration

  log_format  main  '$remote_addr - $remote_user [$time_local] "$request" '
                    '$status $body_bytes_sent "$http_referer" '
                    '"$http_user_agent" "$http_x_forwarded_for"';

  server_names_hash_bucket_size  128; # From EngineYard

  gzip              on;
  gzip_http_version 1.0;
  gzip_comp_level   2;
  gzip_proxied      any;
  gzip_buffers      16 8k;  # From EngineYard
  gzip_types        text/plain text/css application/x-javascript text/xml
                    application/xml application/xml+rss text/javascript;

  client_max_body_size 150M;
  client_body_buffer_size 128k;
  client_body_timeout 3600;

  passenger_ruby <%= AppConf.user.home %>/.rvm/wrappers/ruby-<%= AppConf.ruby.version %>/ruby
  passenger_max_pool_size 8;
  passenger_pool_idle_time 3600;

  include <%= AppConf.nginx.path %>/app_servers/*.conf;
}

