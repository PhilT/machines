# Machine types
# machine 'type', :environment, :roles => [], :apps => []
all_apps = %w(application wiki)
machine 'desktop', :development, :roles => [:app, :db], :apps => all_apps
machine 'staging', :staging, :roles => [:app, :db], :apps => all_apps
machine 'server', :production, :roles => :app, :apps => all_apps
machine 'dbmaster', :production, :roles => :db, :dbmaster, :apps => all_apps
machine 'dbslave', :production, :roles => :db, :dbslave, :apps => all_apps

# Will only be executed for development machines
enviroments :development do
  package :dev_extras
end

# Installed on all machines
package :base

# Installed on machines that have the app role
roles :app do
  install %w(ffmpeg libmagick9-dev)
  package :rvm
  package :ruby
  package :nginx
  package :passenger
  package :passenger_nginx
  package :git
  package :dotfiles
end

# Installed on machines that have the db role
roles :db do
  package :mysql
end

# Installed on machines when user is phil
users 'phil' do
  package :chrome_beta
  package :firefox
  package :gnome
  package :gmate
end

enviroments :development do
  install %w(mysql-query-browser gitk meld) # can gitk be installed before git-core?
end

# Installed on all machines
package :secure_ssh

