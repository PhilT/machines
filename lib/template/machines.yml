# BE CAREFUL: THIS FILE IS ALSO WRITTEN TO BY MACHINES
# This config file is used to read and also write machine settings.
# Comments are retained upto the ---.
#
# Passwords are stored in passwords.gpg - DON'T SET THEM HERE!
#
# Each machine represents a physical (or virtual) computer in your server architecture. This file
# is used to determine where to point database connections from app servers. Because of this,
# database servers must be created before application servers.
#
# Edit this file to setup your initial machines. If using EC2, Machines will populate the
# address setting with the new instance that is created. [EC2 not completed yet]
#
# For example:
#     machines build maindb # creates the master database and sets address in machines.yml
#   then:
#     machines build production # creates the app server and sets db to point to maindb
#
# machines:
#   <machine_name>:
#     hostname: Used to set the hostname of the machine (e.g. main.electricvisions.com)
#     address: IP or DNS name of the machine (this is populated when creating EC2 machines)
#     user: User to login as and to identify the  users/ folder to use
#     environment: Rails.env to use
#     apps: An array of app names to setup on this machine (nil for all, [] for none)
#     roles: Roles of the server (Roles known by standard template are: app, db, dbmaster, dbslave)
#     db_server: <machine_name> of DB server that will be used or replicated from
#               (For dev machines this is normally the same as the machine name (local DB))
#     db_root_pass: Root DB password for db servers (stored in passwords.gpg)
#     replication_user: User to connect with when replicating
#     replication_pass: Password to connect with when replicating (stored in passwords.gpg)
#     ec2: tells Machines to create a new ec2 instance (unless address is already set)
#       type: EC2 Instance Type (e.g. t1.micro, m1.large, c1.xlarge)
#       ami: Amazon Machine Image (e.g. ami-11f0cc65 - EU West 32 bit Ubuntu 11.10 EBS)
#       region: Location of instance (e.g. ec2.eu-west-1.amazonaws.com)
#       public_key_path: Path to public key file
#       private_key_path: Path to private key file
#       username: Instance username (Canonical uses 'ubuntu' in it's AMIs)
#       security_group: Security group you setup on Amazon -  (e.g. ev-public)
#     use_local_ssh_id: Copies local SSH keys instead of generating new ones (for testing)

---
machines:
  testvm:
    hostname: main.electricvisions.com
    address: machinesvm
    user: phil
    environment: development
    apps:
      - condensd
      - fountainwiki
      - velocitytracking
    roles:
      - app
      - db
    db_server: testvm
    use_local_ssh_id: true

  philworkstation:
    hostname: main.electricvisions.com
    address:
    user: phil
    environment: development
    apps:
      - electricvisions
      - condensd
      - fountainwiki
      - merrol
      - somafila
      - velocitytracking
      - eutopia
      - sanity
      - tvs
    roles:
      - app
      - db
    db_server: philworkstation

  maindb:
    hostname: dbmaster.electricvisions.com
    address:
    user: www
    environment: production
    apps:
      - electricvisions
      - condensd
      - fountainwiki
      - merrol
      - somafila
      - velocitytracking
    roles:
      - db
      - dbmaster
    replication_user: repl
    cloud:
      flavor_id: t1.micro
      image_id: ami-11f0cc65 # EU WEST 1 Ubuntu x32 11.10 EBS
      region: eu-west-1
      username: ubuntu

  backupdb:
    hostname: dbslave.electricvisions.com
    address:
    user: www
    environment: production
    apps:
      - electricvisions
      - condensd
      - fountainwiki
      - merrol
      - somafila
      - velocitytracking
    roles:
      - db
      - dbslave
    db_server: maindb
    cloud:
      flavor_id: t1.micro
      image_id: ami-11f0cc65 # EU WEST 1 Ubuntu x32 11.10 EBS
      region: eu-west-1
      username: ubuntu

  staging:
    hostname: staging.electricvisions.com
    address:
    user: www
    environment: staging
    apps:
      - electricvisions
      - condensd
      - fountainwiki
      - merrol
      - somafila
      - velocitytracking
    roles:
      - app
      - db
    db_server: staging
    cloud:
      flavor_id: t1.micro
      image_id: ami-11f0cc65 # EU WEST 1 Ubuntu x32 11.10 EBS
      region: eu-west-1
      username: ubuntu

  production:
    hostname: electricvisions.com
    address:
    user: www
    environment: production
    apps:
      - electricvisions
      - condensd
      - fountainwiki
      - merrol
      - somafila
      - velocitytracking
    roles:
      - app
    db_server: maindb
    cloud:
      flavor_id: t1.micro
      image_id: ami-11f0cc65 # EU WEST 1 Ubuntu x32 11.10 EBS
      region: eu-west-1
      username: ubuntu
