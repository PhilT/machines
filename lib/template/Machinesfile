# Machine types
# machine 'type', :environment, :roles => [], :apps => []
all_apps = %w(application wiki)
machine 'Desktop', :development, :roles => [:app, :db], :apps => all_apps
machine 'Staging', :staging, :roles => [:app, :db], :apps => all_apps
machine 'Production', :production, :roles => :app, :apps => all_apps
machine 'DBmaster', :production, :roles => :db, :dbmaster
machine 'DBslave', :production, :roles => :db, :dbslave

# Installed on all machines
package :base

# Installed on machines that have the app role
roles :app do
  install %w(ffmpeg libmagick9-dev)
  package :rvm
  package :ruby
  package :nginx
  package :passenger
  package :passenger_nginx
  package :git
  package :dotfiles, %w(bashrc gitconfig)
end

# Installed on machines that have the db role
roles :db do
  package :mysql
end

# Installed on machines when user is phil
users 'phil' do
  package :chrome_beta
  package :firefox
  package :gnome
  package :gmate
end

# Will only be executed for development machines
enviroments :development do
  package :dev_extras
  install %w(mysql-query-browser gitk meld) # can gitk be installed before git-core?
end

# Installed on all machines
package :secure_ssh

