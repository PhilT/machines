all_apps = %w(application wiki)
machine 'Desktop', :development, :roles => [:app, :db], :apps => all_apps
machine 'Laptop VM', :development, :roles => [:app, :db], :apps => all_apps
machine 'Staging', :staging, :roles => [:app, :db], :apps => all_apps
machine 'Production', :production, :roles => [:app], :apps => all_apps, :ec2 => true
machine 'DBmaster', :production, :roles => [:db, :dbmaster], :ec2 => true
machine 'DBslave', :production, :roles => [:db, :dbslave], :ec2 => true

package :questions

package :dependencies
package :timezone
package :base
package :virtualbox_guest if AppConf.machine = 'Laptop VM'

only :roles => :app do
  package :monit unless AppConf.environment == :development
  package :dotfiles
  package :webapps
  package :git
  package :rvm
  package :ruby
  package :nginx
  package :passenger
  package :nginx_passenger
  package :nginx_logrotate
  package :postfix unless AppConf.environment == :development
end

only :roles => :db do
  package :mysql
end

only :users => 'phil' do
  package :openbox
  package :apps
  package :chrome
  package :firefox
  package :gmate
  package :docky
  package :unison
end

sudo upgrade

