user <%= AppConf.user.name %>;
worker_processes  4; # Match this with the number of CPUs or increase for large static files

events {
  worker_connections  1024;
}

http {
  include       mime.types;
  default_type  application/octet-stream;

  sendfile            on;
  tcp_nopush          on;
  tcp_nodelay         off;
  keepalive_timeout   65;
  keepalive_requests  0;      # http://technosophos.com/content/nginx-tcpnopush-sendfile-and-memcache-right-configuration

  log_format  main  '$remote_addr - $remote_user [$time_local] \"$request\" '
                    '$status $body_bytes_sent \"$http_referer\" '
                    '\"$http_user_agent\" \"$http_x_forwarded_for\"';

  gzip              on;
  gzip_http_version 1.0;
  gzip_comp_level   2;
  gzip_proxied      any;
  gzip_types        text/plain text/css application/x-javascript text/xml
                    application/xml application/xml+rss text/javascript;

  client_body_buffer_size 128k;   # Size of the memory buffer that will be written to before using a temporary file
  # client_max_body_size 1M;      # Max content that will be served. Increase if media content is to be served
  # client_body_timeout 60;       # Time allowed to respond within in seconds. Increase if requests are expected to take a long time

  passenger_ruby <%= AppConf.user.home %>/.rvm/wrappers/default/ruby
  passenger_max_pool_size 8;                # Max number of simultaneous instances
  passenger_pool_idle_time 0;               # Don't shutdown instances unless needed
  passenger_pre_start http://localhost;     # Prestart RiskPlatform

  include <%= File.join(AppConf.nginx.path, AppConf.nginx.servers_dir, '*.conf') %>;
}

