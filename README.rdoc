== machines

Simple configuration of development, staging and production computers or images for ec2

Ubuntu build script for development and server machines.


* Use filenames in destination paths (e.g. `copy path/filename newpath/filename`)
* Uploads hosts file if it exists in etc/
* Sets hostname
* Green/red output progress indicating success/failure
* All command output logged to `output.log`
* Will try to continue execution even if something fails (so you can fix the issues all at once if they are not dependent)

== Installation and Configuration

* Install the gem
    gem install machines
* Build your machines script `Machinesfile`, e.g.
    machine 'desktop', :development, :apps => %w(app1 app2)
    machine 'main-db', :production, :apps => %w(app1), :role => 'dbmaster'

* Install Ubuntu
* Install SSH Server
    sudo apt-get update
    sudo apt-get -y install openssh-server
* Make a note of the IP of the machine
    ifconfig
* Make sure network interface is loaded on startup
    auto eth0
    iface eth0 inet dhcp
* Make sure network connections are available to all users
* Restart

* Test the Machinesfile
    ssh-keygen -R <host ip> # remove host from known_hosts file (handy when testing)
    rake machines test <configuration> <>

* Setup the machine
    rake setup:machine MACHINE=desktop HOST=ipaddress USERNAME=phil PASSWORD=encrypted
* While running open another terminal to view detailed output
    tail -f output.log

== VirtualBox installation
* Make sure you have Bridged Networking
* Make a note of the IP address


== Status
Under Development. Currently simplifing the setup process and configuration.

== TODO

* Add :abort => true to abort on failed check
* Add groups of tasks to allow starting/stopping at different points in the script
* Add asynchronous ssh so output can be piped live
* Add timer
* Add checking of return values
* More logging needed on initialization
* No longer add a user. Either use `ubuntu` (for EC2 instances) or specified user/pass specified on cmdline

== Warnings
You might see something one of the following while upgrading/installing packages:
    debconf: Unable to initialise frontend: Dialog
    WARNING: Failed to parse default value
    update-rc.d: warning: unattended-upgrades start runlevel arguments

These are all known issues and nothing to worry about

== Note on Patches/Pull Requests

* Fork the project.
* Test drive your feature addition or bug fix
* Commit, do not mess with rakefile, version, or history.
  (if you want to have your own version, that is fine but bump version in a commit by itself I can ignore when I pull)
* Send me a pull request. Bonus points for topic branches.

== Copyright

Copyright (c) 2010 Phil Thompson. See LICENSE for details.

